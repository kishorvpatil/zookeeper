jobs:
  pull-request:
    requires: [~pr]
    environment:
      ZOOKEEPER_DIST_OS: rhel-7.x
    steps:
      - print_env: set
      - build: gmake ${SD_SETTING_MAKE_ARGS} platforms
      - package: gmake ${SD_SETTING_MAKE_ARGS} package-release

  rhel6_build:
    requires: [~commit]
    image: docker-registry.ops.yahoo.com:4443/storm/storm-ci-docker-image-rhel-6.10.3:latest
    environment:
      ZOOKEEPER_DIST_OS: rhel-6.x
    steps:
      - print_env: set
      - build: gmake ${SD_SETTING_MAKE_ARGS} platforms
      - package: gmake ${SD_SETTING_MAKE_ARGS} package-release

  rhel7_build:
    requires: [~commit]
    environment:
      ZOOKEEPER_DIST_OS: rhel-7.x
    steps:
      - print_env: set
      - build: gmake ${SD_SETTING_MAKE_ARGS} platforms
      - package: gmake ${SD_SETTING_MAKE_ARGS} package-release

  publish:
    requires: [rhel6_build, rhel7_build]
    steps:
      - dist_force_push: gmake dist_force_push
      - git_tag: gmake git_tag


shared:
  image: docker-registry.ops.yahoo.com:4443/storm/storm-ci-docker-image-rhel-7.5.4:latest
  annotations:
    screwdriver.cd/cpu: HIGH
    screwdriver.cd/ram: HIGH
  environment:
    USER_SHELL_BIN: bash
    SD_ZIP_ARTIFACTS: false
  settings:
    email:
      addresses: [ zookeeper-devel@verizonmedia.com ]
      statuses: [ FAILURE ]
